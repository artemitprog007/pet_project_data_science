<!DOCTYPE html>
<html>
<head>
    <title>Fetch API Practice</title>
</head>
<body>
    <div class="container">
        <h1>Практика с Fetch API</h1>
        
        <div class="controls">
            <button class="button success" id="getPostsBtn">Получить посты</button>
            <button class="button info" id="getUserBtn">Получить пользователя</button>
            <button class="button error" id="invalidUrlBtn">Неверный URL (ошибка)</button>
            <button class="button" id="createPostBtn">Создать пост (POST)</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">Загрузка...</div>
        <div id="results"></div>
        <div class="log" id="log3"></div>
    </div>

    <script>
        const results = document.getElementById('results');
        const loading = document.getElementById('loading');
        const log3 = document.getElementById('log3');

        function addLog3(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.style.borderLeftColor = type === 'error' ? '#f44336' : 
                                        type === 'success' ? '#4CAF50' : '#2196F3';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log3.appendChild(entry);
        }

        document.getElementById('getPostsBtn').addEventListener('click', async function() {
            addLog3('--- GET ЗАПРОС: Получение постов ---');
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                addLog3('1. Отправляем GET запрос к API...');
                
                const response = await fetch('https://jsonplaceholder.typicode.com/posts?_limit=3');
                
                addLog3(`2. Получен ответ: Status ${response.status}, OK: ${response.ok}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const posts = await response.json();
                addLog3(`3. Данные распарсены, получено ${posts.length} постов`, 'success');
                
                results.innerHTML = posts.map(post => `
                    <div class="post">
                        <h3>${post.title}</h3>
                        <p>${post.body}</p>
                        <small>ID: ${post.id}, UserID: ${post.userId}</small>
                    </div>
                `).join('');
                
            } catch (error) {
                addLog3(`Ошибка: ${error.message}`, 'error');
                results.innerHTML = `<div class="post error">Ошибка: ${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        document.getElementById('getUserBtn').addEventListener('click', async function() {
            addLog3('--- GET ЗАПРОС: Получение пользователя ---');
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const userId = Math.floor(Math.random() * 10) + 1;
                addLog3(`1. Запрашиваем пользователя с ID: ${userId}`);
                
                const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`);
                
                if (!response.ok) {
                    throw new Error(`Пользователь не найден! Status: ${response.status}`);
                }
                
                const user = await response.json();
                addLog3(`2. Получен пользователь: ${user.name}`, 'success');
                
                results.innerHTML = `
                    <div class="post">
                        <h3>${user.name}</h3>
                        <p><strong>Email:</strong> ${user.email}</p>
                        <p><strong>Телефон:</strong> ${user.phone}</p>
                        <p><strong>Website:</strong> ${user.website}</p>
                        <p><strong>Компания:</strong> ${user.company.name}</p>
                        <p><strong>Город:</strong> ${user.address.city}</p>
                    </div>
                `;
                
            } catch (error) {
                addLog3(`Ошибка: ${error.message}`, 'error');
                results.innerHTML = `<div class="post error">${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        });

        document.getElementById('invalidUrlBtn').addEventListener('click', async function() {
            addLog3('--- ОШИБКА СЕТИ: Неверный URL ---');
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const response = await fetch('https://invalid-url-that-does-not-exist.com/data');
                const data = await response.json();
                
            } catch (error) {
                addLog3(`Сетевая ошибка: ${error.message}`, 'error');
                results.innerHTML = `
                    <div class="post error">
                        <h3>Сетевая ошибка</h3>
                        <p>${error.message}</p>
                        <p><small>Fetch не смог выполнить запрос к указанному URL</small></p>
                    </div>
                `;
            } finally {
                loading.style.display = 'none';
            }
        });

        document.getElementById('createPostBtn').addEventListener('click', async function() {
            addLog3('--- POST ЗАПРОС: Создание поста ---');
            loading.style.display = 'block';
            results.innerHTML = '';
            
            try {
                const newPost = {
                    title: 'Новый пост с Fetch API',
                    body: 'Этот пост был создан с помощью JavaScript Fetch API',
                    userId: 1
                };
                
                addLog3('1. Подготавливаем данные для отправки...');
                
                const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(newPost)
                });
                
                addLog3(`2. POST запрос отправлен, статус: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`Ошибка создания поста! Status: ${response.status}`);
                }
                
                const createdPost = await response.json();
                addLog3(`3. Пост создан! ID: ${createdPost.id}`, 'success');
                
                results.innerHTML = `
                    <div class="post">
                        <h3>Пост успешно создан</h3>
                        <p><strong>ID:</strong> ${createdPost.id}</p>
                        <p><strong>Заголовок:</strong> ${createdPost.title}</p>
                        <p><strong>Текст:</strong> ${createdPost.body}</p>
                        <p><strong>UserID:</strong> ${createdPost.userId}</p>
                        <p><em>Примечание: JSONPlaceholder не сохраняет данные, но имитирует успешный ответ</em></p>
                    </div>
                `;
                
            } catch (error) {
                addLog3(`Ошибка: ${error.message}`, 'error');
                results.innerHTML = `<div class="post error">${error.message}</div>`;
            } finally {
                loading.style.display = 'none';
            }
        });
    </script>
</body>
</html>
